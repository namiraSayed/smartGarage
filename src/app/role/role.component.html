<div class="wrap">
  <div class="app-hero-header d-flex align-items-center">

    <!-- Breadcrumb starts -->
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <i class="ri-home-8-line lh-1 pe-3 me-3 border-end"></i>
        <a routerLink="/home">{{'Home'| translate}}</a>
      </li>
      <li class="breadcrumb-item text-primary" aria-current="page">
        <a routerLink="/role-list">{{'Role List'| translate}}</a>
      </li>
      <li class="breadcrumb-item text-primary" aria-current="page">
        <a>{{'Role Add'| translate}}</a>
      </li>
    </ol>
    <!-- Breadcrumb ends -->
  </div>
  <div class="app-body">
    <div class="row gx-3">
      <div class="col-sm-12 col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">{{'Add Role'| translate}}</h5>
          </div>
          <div class="card-body">
            <!-- Row Start -->
            <form [formGroup]="role">
              <div class="row gx-3 mt-1">
                <div class="col-xxl-4 col-lg-4 col-sm-6">
                  <div class="mb-3">
                    <label for="roleName" class="form-label">{{'Role Name' | translate}}:<span
                        class="text-danger">*</span></label>
                    <input type="text" class="form-control" formControlName="roleName" autocomplete="no-fill"
                      placeholder="{{'Role Name' | translate}}"
                      [ngClass]="{ 'is-invalid': submitted && role.controls.roleName.errors }">
                    <div *ngIf="submitted && role.controls.roleName.errors" class="invalid-feedback">
                      <div *ngIf="role.get('roleName')?.errors?.['required']">{{'Role Name is required' | translate}}
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-xxl-4 col-lg-4 col-sm-6">
                  <div class="mb-3">
                    <label for="roleName1" class="form-label">{{'Role Name L' | translate}}:<span
                        class="text-danger">*</span></label>
                    <input type="text" class="form-control" formControlName="roleName1" autocomplete="no-fill"
                      placeholder="{{'Role Name L' | translate}}"
                      [ngClass]="{ 'is-invalid': submitted && role.controls.roleName1.errors }">
                    <div *ngIf="submitted && role.controls.roleName1.errors" class="invalid-feedback">
                      <div *ngIf="role.get('roleName1')?.errors?.['required']">{{'Role Name L is required' | translate}}
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-xxl-2 col-lg-4 col-sm-6">
                  <div class="mb-3">
                    <div class="form-check form-switch mt-4">
                      <input class="form-check-input" type="checkbox" role="switch" formControlName="isActive" id="a7">
                      <label class="form-check-label" for="a7">{{'Status' | translate}}:</label>
                    </div>
                  </div>
                </div>
                <div class="col-xxl-5 col-lg-4 col-sm-6">
                  <div class="mb-3">
                    <label for="firstname" class="form-label">{{'Description' | translate}}:</label>
                    <textarea id="" class="form-control" rows="2" placeholder="{{'Description' | translate}}"
                      formControlName="description" autocomplete="no-fill"></textarea>
                    <!-- <div *ngIf="submitted && role.controls.description.errors" class="invalid-feedback">
                      <div *ngIf="role.get('description')?.errors?.['required']">{{'Description is also required'| translate}}
                      </div>
                    </div> -->
                  </div>
                </div>
                <div class="col-xxl-5 col-lg-4 col-sm-6">
                  <div class="mb-3">
                    <label class="form-label">{{ 'Menu Name' | translate }}:</label>
                    <input type="text" [(ngModel)]="searchText" [ngModelOptions]="{standalone: true}"
                      (input)="applySearch()" placeholder="Search..." class="form-control form-control-sm" />
                    <div class="tree-container">
                      <ul class="tree">
                        <ng-container *ngFor="let node of tree">
                          <ng-container *ngIf="node.visible">
                            <li>
                              <div class="node">

                                <span *ngIf="node.children" class="icon" (click)="toggleExpand(node)"
                                  [class.rotated]="node.expanded">▶</span>

                                <input type="checkbox" [checked]="node.checked" [indeterminate]="node.indeterminate"
                                  (change)="toggleCheck(node, findParent(tree, node))" />

                                {{ node.name }}
                              </div>

                              <ul *ngIf="node.children" class="children" [class.open]="node.expanded">
                                <ng-container
                                  *ngTemplateOutlet="recursive; context:{ $implicit: node.children }"></ng-container>
                              </ul>
                            </li>
                          </ng-container>
                        </ng-container>

                        <!-- Recursive template -->
                        <ng-template #recursive let-list>
                          <ng-container *ngFor="let node of list">
                            <ng-container *ngIf="node.visible">
                              <li>
                                <div class="node">
                                  <span *ngIf="node.children" class="icon" (click)="toggleExpand(node)"
                                    [class.rotated]="node.expanded">▶</span>

                                  <input type="checkbox" [checked]="node.checked" [indeterminate]="node.indeterminate"
                                    (change)="toggleCheck(node, findParent(tree, node))" />

                                  {{ node.name }}
                                </div>

                                <ul *ngIf="node.children" class="children" [class.open]="node.expanded">
                                  <ng-container
                                    *ngTemplateOutlet="recursive; context:{ $implicit: node.children }"></ng-container>
                                </ul>
                              </li>
                            </ng-container>
                          </ng-container>
                        </ng-template>
                      </ul>
                    </div>


                    <!-- <div
                      style="max-height:200px; overflow-y:auto; border:1px solid #ccc; padding:5px; border-radius:5px;">

                      <div class="tree-container">
                        <ng-container *ngFor="let node of appMenu">
                          <ng-container *ngTemplateOutlet="recursiveTree; context:{ $implicit: node }"></ng-container>
                        </ng-container>
                      </div>

                      <ng-template #recursiveTree let-node>
                        <div class="tree-node">
                          <span class="toggle-icon" *ngIf="node.childrenList?.children?.length"
                            (click)="toggleExpand(node)">
                            {{ node.expanded ? '▼' : '▶' }}
                          </span>

                          <input type="checkbox" [checked]="selectedRoleIds.includes(node.appMenuId)"
                            (change)="toggleNode($event, node, selectedRoleIds)" />

                          {{ node.menuName || node.appMenu || node.name }}

                          <div *ngIf="node.expanded" style="margin-left: 20px;">
                            <ng-container *ngIf="node.children?.length">
                              <ng-container *ngFor="let child of node.children">
                                <ng-container *ngTemplateOutlet="recursiveTree; context:{ $implicit: child }"></ng-container>
                              </ng-container>
                            </ng-container>
                          </div>
                        </div>
                      </ng-template>
                    </div> -->
                  </div>
                </div>
              </div>
            </form>

            <div class="col-sm-12">
              <div class="d-flex gap-2 justify-content-end">
                <a type="button" class="btn btn-outline-secondary" routerLink="/role-list">{{'Cancel'| translate}}</a>
                <a *ngIf="editMode" type="button" class="btn btn-primary" (click)="submitRole()">{{'Update'| translate}}
                </a>
                <a *ngIf="!editMode" type="button" class="btn btn-primary" (click)="submitRole()">{{'Save'| translate}}
                </a>
              </div>
            </div>

          </div>
        </div>
            <!-- Row starts -->
      <div class="row gx-3 mt-3" *ngIf="editMode">
        <div class="col-sm-12">
          <div class="accordion mb-3" id="accordionSpecialTitle">
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingSpecialTitleOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseSpecialTitleOne" aria-expanded="true"
                  aria-controls="collapseSpecialTitleOne">
                  <div class="d-flex flex-column">
                    <h5 class="m-0">Acl</h5>
                  </div>
                </button>
              </h2>
              <div id="collapseSpecialTitleOne" class="accordion-collapse collapse show"
                aria-labelledby="headingSpecialTitleOne" data-bs-parent="#accordionSpecialTitle">
                <div class="accordion-body">
                  <div class="row">
                      <form [formGroup]="roleacl">
              <div class="row gx-3 mt-1">
                 <div class="col-xxl-4 col-lg-4 col-sm-6">
                  <div class="mb-3">
                    <label for="roleName1" class="form-label">Menu:<span
                        class="text-danger">*</span></label>
                   <select class="form-select" id="6" formControlName="appMenuId">
                      <option value="0">Select Control</option>
                        <option *ngFor="let ctrl of controlData" [value]="ctrl.appControlId">
                         {{ctrl.description}}
                        </option>
                    </select>
                    <div *ngIf="submitted && roleacl.controls.appMenuId.errors" class="invalid-feedback">
                      <div *ngIf="roleacl.get('appMenuId')?.errors?.['required']">{{'Role Name 1 is required' | translate}}
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-xxl-4 col-lg-4 col-sm-6">
                  <div class="mb-3">
                    <label for="roleName" class="form-label">Control:<span
                        class="text-danger">*</span></label>
                   <select class="form-select" id="6" formControlName="appControlId">
                      <option value="0">Select Control</option>
                        <option *ngFor="let ctrl of controlData" [value]="ctrl.appControlId">
                         {{ctrl.description}}
                        </option>
                    </select>
                    <div *ngIf="submitted && roleacl.controls.appControlId.errors" class="invalid-feedback">
                      <div *ngIf="roleacl.get('appControlId')?.errors?.['required']">appControlId is required
                      </div>
                    </div>
                  </div>
                </div>
               
                <div class="col-xxl-2 col-lg-4 col-sm-6">
                  <div class="mb-3">
                    <div class="form-check form-switch mt-4">
                      <input class="form-check-input" type="checkbox" role="switch" formControlName="isActive" id="a7">
                      <label class="form-check-label" for="a7">{{'Status' | translate}}:</label>
                    </div>
                  </div>
                </div>
              </div>
            </form>
                  </div>
                  <div class="table-outer mt-3">
                    <div class="table-responsive">
                      <table class="table truncate m-0">
                        <thead>
                          <tr>
                            <th>Menu</th>
                            <th>Control</th>
                            <th>Privilage</th>
                            <th>Status</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          @for(acl of roleAclData; track acl) {
                          <tr>
                            <td>{{acl.appMenuName }}</td>
                            <td>{{acl.appControlDesc}}</td>
                            <td>{{acl.appPrivilegeDesc}}</td>
                            <td>
                              @if(acl.isActive == true) {
                              <span class="badge border border-primary text-primary">Active</span>
                              }
                              @if(acl.isActive == false) {
                              <span class="badge border border-primary text-primary">In Active</span>
                              }
                            </td>
                            <td class="p-1">
                              <a class="btn btn-outline-success btn-sm table-btn" data-bs-placement="bottom"
                                title="Edit" data-bs-toggle="tooltip" (click)="editAcl(acl)">
                                <i class="ri-edit-box-line"></i>
                              </a>
                              <!-- <a class="btn btn-outline-danger btn-sm table-btn" data-bs-toggle="modal" href="#">
                                <i class="ri-delete-bin-line"></i>
                              </a> -->
                            </td>
                          </tr>
                          }

                        </tbody>
                      </table>
                    </div>
                  </div>
                 
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Row ends -->
      </div>
    </div>
  </div>
</div>